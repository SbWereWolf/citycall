# Биржа рабов ( API для публикации каталога во внешние системы )

| **        Содержание** |
| --- |
| Техническое решение        |
| Шаблон адреса пользовательского запроса        |
| Допущения в описаниях адресов для запросов клиента        |
| Статус обработки запроса        |
| Методы        |
| Получить версии API        |
| Получить доступные переводы для версии        |
| Открыть сессию        |
| Изменить таймаут        |
| Ответ не содержит тела.        |
| Закрыть сессию        |
| Получить номенклатуру атрибутов Раба        |
| Получить описание атрибута        |
| Получить описание справочника        |
| Получить запись справочника        |
| Получить границы отбора по атрибуту        |
| Установить условия выборки записей каталога        |
| Ответ не содержит тела.        |
| Получить условия выборки        |
| Сбросить условия выборки        |
| Ответ не содержит тела.        |
| Получить выборку записей        |
| Получить расписание Раба        |
| Пояснительная записка        |
| Назначение системы        |
| Предметная область        |
| Границы проекта        |
| Выбор стека технологий        |
| Реализация        |
| Запросы пользователя        |
| Безопасность        |
| Применение современного уровня развития науки и техники        |
| Назначение методов доступа        |
| Получить версии API        |
| Получить доступные переводы для версии        |
| Открыть сессию        |
| Изменить таймаут        |
| Задать значение таймаута по истечению которого сессия считается закрытой.        |
| Закрыть сессию        |
| Получить номенклатуру атрибутов Раба        |
| Получить описание атрибута        |
| Получить описание справочника        |
| Получить запись справочника        |
| Получить границы отбора по атрибуту        |
| Установить условия выборки записей каталога        |
| Получить условия выборки        |
| Сбросить условия выборки        |
| Получить выборку записей        |
| Получить расписание Раба        |
| Описание информационных процессов        |

## Задание

Разработать техническое задание на API &quot;Биржа рабов&quot;.

## Исходные данные

1. сущности биржи в соответствии с [документом](https://github.com/SbWereWolf/slave-market/blob/master/readme.md)
2. Разработать требования к кодированию информации
3. Использовать авторизацию по API key
4. Обязательно разработать требования к методам :
  1. Получение нормативно справочной информации
  2. Получение каталога рабов
  3. Бронирование раба
  4. Починка раба

Требования к результату :

1. Описание информационных процессов
2. Пояснительная записка
3. Техническое решение
4. Методология по ГОСТ 34, РД 50

Дополнительно результат должен содержать :

1. Use case : поиск + бронирование
2. Границы проекта ( функционал и задачи которые проект не решает )

## Решение

Техническое решение

Сервис API является сервером клиентских запросов ( запросов пользователя API на предоставление услуг).

Клиент и сервер обмениваются сообщениями по протоколу HTTP/2.

Сервер API принимает запросы клиента на URL адрес сервиса. Параметры запроса передаются в адресе (в качестве части адреса запроса после адреса сервиса), и могут быть переданы в теле запроса.

Параметры ответа передаются в теле ответа. Статус ответа устанавливается в соответствии с результатом обработки клиентского запроса.

В качестве тела запроса и тела ответа используется массив пар ключ-значение в формате JSON, где ключ (индекс элемента массива) это код параметра, а значение элемента массива это собственно значение параметра.

Шаблон адреса пользовательского запроса

В общем виде адрес запроса соответствует шаблону

| HTTPS://{service\_dns\_address}/{version}/{translation}/{entity}/{action\_or\_attribute}/{identifier}?token={apikey} |
| --- |

, где :

service\_dns\_address - HTTP адрес сервера сервиса API

version - версия API (код версии)

translation - перевод (код перевода), который следует использовать для интерфейса (для значений служебных параметров)

apikey - идентификатор сессии

entity - тип объекта

action\_or\_attribute - действие над объектом, либо атрибут объекта

identifier - идентификатор объекта

Допущения в описаниях адресов для запросов клиента

Часть адреса &quot;HTTPS://{service\_dns\_address}/&quot; подразумевается как начало каждого адреса для запросов клиента и не указывается в описании методов API.

Параметры &quot;version&quot;, &quot;translation&quot;, &quot;apikey&quot; в адресах всех запросов должны использоваться описанным образом ( в разделе &quot;Шаблон адреса пользовательского запроса&quot;), назначение этих параметров будет опущено в описании методов.

Статус обработки запроса

Статус обработки запроса возвращается в качестве кода статуса HTTP ответа.

Коды статусов HTTP ответа

| **HTTP status code** | **Значение** |
| --- | --- |
| 200 | Запрос обработан успешно |
| 400 | Ошибка в структуре JSON передаваемого запроса |
| 401 | Имя и/или пароль пользователя указаны неверно или  пользователь заблокирован |
| 403 | У вас нет прав на просмотр данного объекта |
| 404 | Запрошенный ресурс не существует |
| 410 | Версия API не поддерживается |
| 411 | Указанный перевод не существует |
| 412 | Не указан обязательный параметр строки запроса или поле структуры JSON |
| 500 | При обработке запроса возникла непредвиденная ошибка |
| 502 | Сервис временно недоступен |
| 503 | Сервис временно отключен |
| 504 | Превышен таймаут обращения к сервису, повторите попытку позднее |

Методы

Получить версии API

**Запрос**

Метод GET, без указания ресурса, без параметров в адресе ресурса.

**Ответ**

|   |   |   |   |
| --- | --- | --- | --- |
| versions | массив | массив строковых элементов | допустимые коды версий |

Получить доступные переводы для версии

**Запрос**

Метод GET, адрес {version}

| Параметр | Тип | Ограничения на значения | Пояснение |
| --- | --- | --- | --- |
| version | строка | допустимый код версии | код версии для которой требуется получить список доступных переводов |

**Ответ**

|   |   |   |   |
| --- | --- | --- | --- |
| translations | массив | массив строковых элементов | допустимые коды переводов |

Открыть сессию

**Запрос**

Метод GET, адрес {version}/{translation}/session/{login}/{secret}/{timeout}

| Параметры | Тип | Значения | Пояснение |
| --- | --- | --- | --- |
| login | строка | логин зарегистрированной учётной записи | логин учётной записи |
| secret | строка | пароль соответствующий логину | пароль учётной записи |
| timeout | целое число | от 300 до 31536000 | Количество времени( в секундах) по истечению которого сессия пользователя перестанет считаться открытой, время считается от последнего запроса пользователя, по умолчанию используется значение 3600 |

**Ответ**

|   |   |   |   |
| --- | --- | --- | --- |
| apikey | строка | 52 буквенно-цифровых символа | токен открытой сессии, требуется для авторизации действий пользователя |

Изменить таймаут

**Запрос**

Метод PATCH, адрес {version}/{translation}/session

| Параметры | Тип | Значения | Пояснение |
| --- | --- | --- | --- |
| timeout | целое число | от 300 до 31536000 | Количество времени( в секундах) по истечению которого сессия пользователя перестанет считаться открытой, время считается от последнего запроса пользователя, по умолчанию используется значение 3600 |
| apikey | строка | 52 буквенно-цифровых символа | токен сессии пользователя |

**Ответ**

Ответ не содержит тела.

Закрыть сессию

**Запрос**

Метод DELETE, адрес {version}/{translation}/session

| Параметры | Тип | Значения | Пояснение |
| --- | --- | --- | --- |
| apikey | строка | 52 буквенно-цифровых символа | токен сессии пользователя |

**Ответ**

Ответ не содержит тела.

Получить номенклатуру атрибутов Раба

**Запрос**

Метод GET, адрес{version}/{translation}/slave/attributes?{apikey}

**Ответ**

|   |   |   |   |
| --- | --- | --- | --- |
| attributes | массив | массив строковых элементов | коды атрибутов |

Получить описание атрибута

**Запрос**

Метод GET, адрес {version}/{translation}/attribute/description/{code}?token={apikey}

| Параметры | Тип | Значения | Пояснение |
| --- | --- | --- | --- |
| code | строка | допустимый код атрибута | атрибут для которого требуется описание |

**Ответ**

|   |   |   |   |
| --- | --- | --- | --- |
| code | строка | от 8 до 128 символов | код |
| name | строка | от 2 до 32 символов | название |
| hint | строка | от 2 до 32 символов | подсказка |
| description | строка | от 2 до 4000 символов | описание |
| unit | строка | от 8 до 128 символов | код единицы измерения атрибута  ( справочник значений  unit) |
| type | строка | от 8 до 128 символов | код для типа значения атрибута, например  &quot;numeric&quot;, &quot;string&quot;, &quot; date&quot;, &quot; interval&quot; ( справочник значений  type) |
| methods | массив | массив строковых элементов | коды методов выборки для атрибута, например &quot;greater&quot;, &quot;less&quot;, &quot; equal&quot;,  like&quot;, &quot;between&quot;, &quot;numerous&quot; ( справочник значений  methods) |
| reference | строка | от 8 до 128 символов | код справочника значений атрибута |

Получить описание справочника

**Запрос**

Метод GET, адрес {version}/{translation}/reference/{code}?token={apikey}

| Параметры | Тип | Значения | Пояснение |
| --- | --- | --- | --- |
| code | строка | допустимый код атрибута | код справочника для которого требуется описание |

**Ответ**

|   |   |   |   |
| --- | --- | --- | --- |
| code | строка | от 8 до 128 символов | код |
| name | строка | от 2 до 32 символов | название |
| description | строка | от 2 до 4000 символов | описание |
| enumeration | массив | массив строковых элементов | коды значений справочника |

Получить запись справочника

**Запрос**

Метод GET, адрес {version}/{translation}/reference/item/{code}?token={apikey}

| Параметры | Тип | Значения | Пояснение |
| --- | --- | --- | --- |
| code | строка | допустимый код атрибута | код записи справочника |

**Ответ**

|   |   |   |   |
| --- | --- | --- | --- |
| code | строка | от 8 до 128 символов | код записи справочника |
| name | строка | от 2 до 32 символов | название |
| description | строка | от 2 до 4000 символов | описание |
| value | строка | от 8 до 128 символов | значение записи справочника |

Получить границы отбора по атрибуту

**Запрос**

Метод GET, адрес {version}/{translation}/attribute/range/{code}?token={apikey}

| Параметры | Тип | Значения | Пояснение |
| --- | --- | --- | --- |
| code | строка | допустимый код атрибута | атрибут для которого требуется диапазон поиска |

**Ответ**

|   |   |   |   |
| --- | --- | --- | --- |
| enumeration | массив | массив строковых элементов | имеющиеся у опубликованных  рабов значения из справочника значений атрибута |
| minimum | число | double precision | имеющееся у опубликованных рабов минимальное значение атрибута |
| maximum | число | double precision | имеющееся у опубликованных рабов максимальное значение атрибута |

Установить условия выборки записей каталога

**Запрос**

Метод PATCH, адрес {version}/{translation}/slave/filter

| Параметры | Тип | Значения | Пояснение |
| --- | --- | --- | --- |
| code | строка | допустимый код атрибута | атрибут для которого требуется установить правила выборки |
| method | строка | код метода отбора | метод с помощью которого будет определено соответствует ли значение параметрам выборки |
| value | строка | строковое представление значения атрибута | значение фильтра для сравнения со значением атрибута |
| apikey | строка | 52 буквенно-цифровых символа | токен сессии пользователя |

**Ответ**

Ответ не содержит тела.

Получить условия выборки

**Запрос**

Метод GET, адрес {version}/{translation}/slave/filter?token={apikey}

**Ответ**

|   |   |   |   |
| --- | --- | --- | --- |
| filters | массив | массив массивов | элементы массива содержат условия выборки(в формате массива) установленные с методом &quot;Установить условия выборки записей каталога&quot; ( PATCH, {version}/{translation}/slave/filter ) |

Сбросить условия выборки

**Запрос**

Метод DELETE, адрес {version}/{translation}/slave/filter

|   |   |   |   |
| --- | --- | --- | --- |
| apikey | строка | 52 буквенно-цифровых символа | токен сессии пользователя |

**Ответ**

Ответ не содержит тела.

Получить выборку записей

**Запрос**

Метод GET, адрес {version}/{translation}/slave/list/{page}/{limit}?token={apikey}

|   |   |   |   |
| --- | --- | --- | --- |
| limit | число | целое положительное число | количество рабов на странице поисковой выдачи |
| page | число | целое положительное число | индекс страницы поисковой выдачи |

**Ответ**

|   |   |   |   |
| --- | --- | --- | --- |
| slaves | массив | массив массивов | элементы массива содержат массив атрибутов раба |

Получить расписание Раба

**Запрос**

Метод GET, адрес {version}/{translation}/slave/busyness/{start}/{finish}/{identifier}?token={apikey}

|   |   |   |   |
| --- | --- | --- | --- |
| identifier | строка | идентификатор опубликованного раба | идентификатор раба |
| start | дата | любая дата меньшая чем finish не более чем на 36 500 дней | расписание раба будет выдано начиная с этой даты |
| finish | дата | любая дата большая чем start не более чем на 36 500 дней | расписание раба будет выдано заканчивая этой датой |
|   |   |   |   |

**Ответ**

|   |   |   |   |
| --- | --- | --- | --- |
| busyness | массив | строковый массив | индекс элемента это дата, содержимое элемента это код значения из справочника &quot;Занятость&quot; ( выставлен арендован продан) |

Пояснительная записка

Назначение системы

Система предназначена для публикации информации о рабах представленных на бирже.

Предметная область

Биржа рабов предоставляет услуги по продаже, аренде рабов, техническому обслуживанию (профилактические осмотры, лечение) и модернизации (обучение) рабов.

Раб может находиться в следующих состояниях: быть выставлен для аренды, арендован, на профилактике, недоступен.

Раб может быть продан, после продажи раб может быть выставлен для аренды или стать недоступным для аренды.

Рабы имеют следующие обязательные атрибуты :

1. Идентификатор;
2. Состояние;
3. Дата состояния;

Рабы могут иметь дополнительные атрибуты, например :

1. Кличка;
2. Пол;
3. Возраст;
4. Вес;
5. Цвет кожи;
6. Где пойман/выращен;
7. Описание и повадки;
8. Ставка аренды;
9. Стоимость;

Возможные значения атрибута могут быть ограничены значениями из какого либо справочника.

Перечень дополнительных атрибутов может быть произвольным и для каждого внедрения сервиса (для каждого сервера) этот перечень уникален.

Границы проекта

Проект описывает функционал получения информации о рабах представленных на бирже, включая информацию о занятости рабов, включая служебную информацию о справочниках значений атрибутов и границ области поиска по каталогу.

Проект не описывает способов бронирования, аренды, приобретения или подачи заявки на выполнение гарантийных обязательств.

Проект описывает только формат запросов и ответов между клиентом и сервером.

Проект не описывает алгоритмов хранения и манипуляций с данными.

Проект описывает аутентификацию пользователя и авторизацию его действий, но не описывает регистрации пользователя, изменения настроек пользователя и других операций с пользователем.

Выбор стека технологий

Для уменьшения трудоёмкости при реализации проекта будут применены существующие технические решения.

Для реализации функционала требуется определить взаимодействие пользователя с системой. Взаимодействие будет интерактивным по модели клиент-сервер (нет необходимости в обработке пакета команд, нет необходимости в разработке клиентской части).

В качестве транспорта сообщений (служебной информации и собственно сообщения) выберем HTTP/2, как актуальный на настоящий момент протокол передачи данных.

Протокол включает в себя кодирование методов доступа к данным, кодирование статуса обработки запроса, протокол реализует возможность дополнительных настроек обмена через использование заголовков запросов (сообщений).

Протокол HTTP/2 следует использовать совместно с TLS для шифрования запросов, запрос может содержать конфиденциальную информацию (реквизиты учётной записи, токен доступа) раскрытие которой может нанести ущерб пользователю или нарушить его работу с сервисом.

В качестве формата для кодирования содержательной части сообщений выберем JSON, формат предусматривает кодирование необходимого на проекте перечня типов данных, формат достаточно жёсткий, поэтому потребность в мета данных сокращается (не требуется дополнительного описания типов данных, не требуется описания структуры сообщения), имеющейся гибкости достаточно.

Реализация

Запросы пользователя

Запросы пользователя сервиса API &quot;Биржа рабов&quot; следует формировать в соответствии с методами доступа к сервису.

Безопасность

Клиент и сервер обмениваются сообщениями (запросами и ответами) зашифрованными с использованием TLS.

Функционал биржи требует авторизации.

Функционал сервиса требует аутентификации при открытии сессии и авторизации при выполнении других действий с сессией.

Функционал запроса версий и переводов не требует ни аутентификации, ни авторизации.

Применение современного уровня развития науки и техники

Современные лучшие практики рекомендуют реализовать версионирование методов доступа к информации, для лучшей обратной совместимости сервиса, каждая следующая версия полностью и без изменений поддерживает функционал предыдущих версий.

Современные лучшие практики рекомендуют разрабатывать сервисы с учётом мультиязычности, это позволяет расширять клиентскую базу без необходимости перепроектирования API, широкая клиентская база повышает шансы на коммерческую успешность системы.

Современный опыт развития ПО показывает, что продукты с возможностью настройки функционала под потребности конкретного пользователя способствуют широте распространения ПО, следовательно - коммерческому успеху, поэтому список атрибутов рабов является открытым.

Назначение методов доступа

Получить версии API

Позволяет получить список всех версий сервиса поддерживаемых сервером.

Получить доступные переводы для версии

Список всех переводов сервиса поддерживаемых сервером для указанной версии сервиса.

Открыть сессию

Сервер проводит аутентификацию пользователя и выдаёт API key для авторизации запросов пользователя ( токен открытой сессии).

Изменить таймаут

Задать значение таймаута по истечению которого сессия считается закрытой.

Закрыть сессию

Закрыть указанную (с помощью токена) сессию.

Получить номенклатуру атрибутов Раба

Получить полный список атрибутов раба поддерживаемых сервером.

Получить описание атрибута

Получить описание атрибута и код справочника, если атрибут принимает справочные значения.

Получить описание справочника

Получить описание справочника и список значений справочника.

Получить запись справочника

Получить запись справочника включая название записи, описание записи и значение записи.

Получить границы отбора по атрибуту

Получить границы поиска по атрибуту, для числовых атрибутов максимальное и минимальное значения из встречающихся в значениях атрибута, для справочных атрибутов все использованные для описания рабов  значения справочника.

Установить условия выборки записей каталога

Установить условия отбора для атрибута, все условия применяются через логическое И (AND).

Получить условия выборки

Получить текущие условия выборки заданные для сессии.

Сбросить условия выборки

Удалить все условия выборки заданные для сессии.

Получить выборку записей

Получить информацию из каталога с учётом наложенных условий выборки.

Получить расписание Раба

Получить расписание занятости раба (выставлен, не доступен, арендован) для заданного периода времени, с детализацией до дня.

Описание информационных процессов

Работа с сервисом делиться на две части : организационную и собственно функциональную.

К организационной части относиться:

получение списка версий и переводов

открытие сессии, изменение таймаута сессии, закрытие сессии.

Функциональная:

Получение каталога, получение атрибутов раба, получение описаний атрибутов рабов, получение описаний справочных значений;

Получение границ отбора по атрибуту, установка условий выборки, выборка, сброс условий выборки;

Получить расписание занятости раба;

Пользовательские истории

Узнать какие рабы доступны для аренды и продажи.

Узнать сколько раб работал и отдыхал на прошлой неделе.

Узнать когда у раба был последний профилактический осмотр.

Узнать стоимость самого дешёвого раба.

Узнать самую высокую и самую низкую цену аренды раба.

Узнать из каких местностей происходят выставленные рабы.

Вариант использования

Описание использования состоит из серии запросов и принятия решений по формированию запросов на основе полученных ответов.

Работа с сервисом осуществляется с использованием приложения клиента.

Узнать какие рабы доступны для аренды и продажи

Использование

Получить список поддерживаемых версий API, выполнить HTTPS://{service\_dns\_address}/. Ответ сервера будет содержать допустимые для использования коды версий.

Получить список поддерживаемых переводов, GET HTTPS://{service\_dns\_address}/{version}, где version - версия выбранная клиентом для работы с сервером. Получаем варианты перевода.

Открыть сессию GET, адрес HTTPS://{service\_dns\_address}/{version}/{translation}/session/{login}/{secret}/{timeout}, где

translation - выбранный перевод для интерфейса,

login - имя учётной записи,

secret - пароль,

timeout - желаемый таймаут сессии.

Сервер сообщит apikey - токен для идентификации сессии (пользователь может одновременно работать в нескольких сессиях) и авторизации запросов пользователя.

Получить границы отбора по атрибуту busyness, GET HTTPS://{service\_dns\_address}/{version}/{translation}//attribute/range/busyness?token={apikey}, сервер вернёт список значений атрибута busyness у представленных на бирже рабов. Проверить что значение await присутствует в списке.

Установить условия выборки записей каталога, PATCH HTTPS://{service\_dns\_address}/{version}/{translation}/slave/filter

code - busyness

method - equal

value - await

apikey - полученный от сервера при открытии сессии токен идентификации сессии.

Добавить условие по началу периода во время которого раб должен быть доступен, PATCH HTTPS://{service\_dns\_address}/{version}/{translation}/slave/filter

code - date

method - greater

value - дата начала периода

Добавить условие по окончанию периода во время которого раб должен быть доступен, PATCH HTTPS://{service\_dns\_address}/{version}/{translation}/slave/filter

code - date

method - less

value - дата окончания периода

Получить выборку записей GET HTTPS://{service\_dns\_address}/{version}/{translation}/slave/list/0/0?token={apikey}.

В ответе сервера будет список всех рабов доступных для аренды в указанный период.

Информация о рабах доступных для аренды и продажи в требуемые период получена.

Если дальнейшая работа с сервером не планируется, то по таймауту сессия будет закрыта, также можно принудительно закрыть сессию :

Закрыть сессию DELETE HTTPS://{service\_dns\_address}/{version}/{translation}/session, в теле запроса :

apikey установить равным соответствующему значению полученному от сервиса при открытии сессии.
